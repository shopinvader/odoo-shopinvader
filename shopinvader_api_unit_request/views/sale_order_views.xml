<?xml version="1.0" encoding="UTF-8" ?>
<!-- Copyright 2024 Akretion (http://www.akretion.com). -->
<!-- @author Florian Mounier <florian.mounier@akretion.com> -->
<!-- License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->
<odoo>
  <record id="view_order_form" model="ir.ui.view">
    <field name="model">sale.order</field>
    <field name="inherit_id" ref="sale.view_order_form" />
    <field name="arch" type="xml">
      <button name="action_confirm" position="before">
        <button
                    name="action_request_cart"
                    string="Request Cart"
                    class="btn-info"
                    type="object"
                    attrs="{'invisible': [('typology', '!=', 'cart')]}"
                />
      </button>
      <page name="order_lines" position="before">
        <page
                    string="Requests"
                    name="order_line_all_requested_ids"
                    attrs="{'invisible': [('typology', '!=', 'request')]}"
                >
          <field name="order_line_all_requested_ids">
            <tree
                            string="Requested Lines"
                            editable="bottom"
                            decoration-success="request_accepted"
                            decoration-danger="request_rejected"
                        >
              <field name="request_accepted" invisible="1" />
              <field name="request_rejected" invisible="1" />
              <field name="company_id" invisible="1" />
              <field name="product_id" />
              <field name="qty_requested" />
              <field name="product_uom_qty" />
              <field name="request_rejection_reason" />
            </tree>
          </field>
        </page>
      </page>
    </field>
  </record>


  <record model="ir.actions.act_window" id="sale_order_act_window">
    <field name="name">Requests</field>
    <field name="res_model">sale.order</field>
    <field name="view_mode">tree,form,calendar,graph</field>
    <field name="search_view_id" ref="sale.view_sales_order_filter" />
    <field name="context">{'default_typology': 'request'}</field>
    <field name="domain">[('typology', '=', 'request')]</field>
  </record>

  <menuitem
        action="sale_order_act_window"
        id="sale_order_menu"
        parent="sale.sale_menu_root"
        sequence="4"
        groups="sales_team.group_sale_salesman,sales_team.group_sale_manager"
    />
</odoo>
